<!DOCTYPE html>
<html>
<head>
  <title>Xendit Manual Card Charge</title>
  <script src="https://js.xendit.co/v1/xendit.min.js"></script>
</head>
<body>
  <h2>Charge Booking.com Card</h2>
  <form id="card-form">
    <label>First Name:</label><br>
    <input type="text" id="first_name" placeholder="John" required><br><br>

    <label>Last Name:</label><br>
    <input type="text" id="last_name" placeholder="Doe" required><br><br>

    <label>Email:</label><br>
    <input type="email" id="email" placeholder="guest@example.com" required><br><br>

    <label>Phone Number:</label><br>
    <input type="tel" id="phone" placeholder="+6281234567890"><br><br>

    <label>Card Number:</label><br>
    <input type="text" id="card_number" placeholder="4111 1111 1111 1111" required><br><br>

    <label>Expiry Month:</label><br>
    <input type="text" id="expiry_month" placeholder="MM" required><br><br>

    <label>Expiry Year:</label><br>
    <input type="text" id="expiry_year" placeholder="YYYY" required><br><br>

    <label>CVV:</label><br>
    <input type="text" id="cvn" placeholder="123" required><br><br>

    <label>Amount (IDR):</label><br>
    <input type="number" id="amount" placeholder="100000" required><br><br>

    <button type="submit">Charge Card</button>
  </form>

  <div id="result" style="margin-top: 20px;"></div>

  <script>
    const publishableKey = 'xnd_public_production_z5XooZH1_MhacolSwdToZdY9zgez4emzzbEEpViGtLnouqf22GmNfMGtVvbY7'; // Replace with your real public key
    Xendit.setPublishableKey(publishableKey);

    const form = document.getElementById('card-form');
    const resultDiv = document.getElementById('result');

    form.addEventListener('submit', function (e) {
      e.preventDefault();

      Xendit.card.createToken({
        amount: parseInt(document.getElementById('amount').value),
        card_number: document.getElementById('card_number').value,
        card_exp_month: document.getElementById('expiry_month').value,
        card_exp_year: document.getElementById('expiry_year').value,
        card_cvn: document.getElementById('cvn').value,
        card_holder_first_name: document.getElementById('first_name').value,
        card_holder_last_name: document.getElementById('last_name').value,
        card_holder_email: document.getElementById('email').value,
        card_holder_phone_number: document.getElementById('phone').value,
      }, function (err, creditCardToken) {
        if (err) {
          resultDiv.innerHTML = '<p style="color:red">❌ Tokenization failed: ' + err.message + '</p>';
        } else {
          resultDiv.innerHTML = '<p style="color:green">✅ Token created, charging now...</p>';

          fetch('/api/charge', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              token_id: creditCardToken.id,
              amount: parseInt(document.getElementById('amount').value),
            }),
          })
          .then(res => res.json())
          .then(data => {
            if (data.success) {
              resultDiv.innerHTML = '<p style="color:green">✅ Charge successful!<br>' + JSON.stringify(data.charge, null, 2) + '</p>';
            } else {
              resultDiv.innerHTML = '<p style="color:red">❌ Charge failed:<br>' + JSON.stringify(data.error, null, 2) + '</p>';
            }
          })
          .catch(err => {
            resultDiv.innerHTML = '<p style="color:red">❌ Network error: ' + err.message + '</p>';
          });
        }
      });
    });
  </script>
</body>
</html>
